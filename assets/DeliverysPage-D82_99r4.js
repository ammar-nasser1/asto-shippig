import{_ as ae}from"./eye-BFqmBmJx.js";import{_ as se}from"./failer-Dtv5Mqu6.js";import{x as le,p as oe,r as d,f as ne,B as re,v as w,g as ie,y as f,c,o as n,m as r,l as v,a as s,d as p,u as _,b as M,k as $,t as q}from"./index-CHk3YsRe.js";import{_ as de}from"./ActionMenu-CxH-u6TU.js";import{c as ue,a as k,b as ce,u as pe}from"./index.esm-C0_1Yzr3.js";import{_ as D}from"./InputField.vue_vue_type_script_setup_true_lang-KsgUpcUb.js";import{r as z,a as N}from"./EyeIcon-C3LiGQhh.js";const me={class:"flex flex-col gap-4 w-full"},fe={key:0,class:"text-green-500 bg-green-100 p-1 text-sm rounded-xl w-40 text-center"},ve={key:1,class:"text-red-500 bg-red-100 p-1 text-sm rounded-xl w-40 text-center"},_e={class:"flex gap-2"},xe={class:"border border-[#CBD7E1] rounded-lg p-2 mb-1"},ge={class:"flex flex-col gap-y-1 pt-3"},ye={for:"password",class:"text-gray-700 text-sm text-start mt-4"},be={key:0,class:"text-red-500"},he={for:"confirm_password",class:"text-gray-700 text-sm text-start mt-4"},we={key:0,class:"text-red-500"},ke={key:0,class:"bg-red-100 rounded-[12px] flex gap-2 py-3 mt-4 px-4 items-center text-sm text-start"},De={class:"flex justify-end items-center w-full gap-2 mt-4"},Ce=["disabled"],Ee={key:0,class:""},$e={key:1},qe={__name:"DeliverysPage",setup(Se){le();const x=oe(),C=d(!1),S=d([]),V=d(""),A=d(""),O={},g=d({count:0,next:null,previous:null,page:1,pageSize:10}),Q=ne(()=>(g.value.page-1)*g.value.pageSize),I=[{label:" الاسم",key:"full_name"},{label:" إجمالي العمولات",key:"sales"},{label:" الرصيد ",key:"balance"},{label:" إجمالي الطلبات",key:"order_count"},{label:"الحالة",key:"is_active"},{label:"",key:"action"}],j=t=>[{label:"تعديل",handler:()=>W(t),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{o.id=t,o.site_name=S.value.find(e=>e.id===t).full_name,C.value=!0},class:"text-red-500 hover:bg-gray-100"}],o=re({id:null,site_name:""}),G=ue({full_name:k().required("الاسم مطلوب"),phone_number:k().required("رقم الهاتف مطلوب"),email:k().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"),password:k().when([],{is:()=>!o.id,then:t=>t.required("كلمة المرور مطلوبة").min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل"),otherwise:t=>t.nullable().transform((e,a)=>a===""?null:e).min(8,"كلمة المرور يجب أن تكون 8 أحرف على الأقل")}),confirm_password:k().when("password",{is:t=>t&&t.length>0,then:t=>t.required("تأكيد كلمة المرور مطلوب").oneOf([ce("password")],"كلمة المرور غير متطابقة"),otherwise:t=>t.nullable()})}),{handleSubmit:H,resetForm:R,setValues:J,setFieldError:B,errors:Ve}=pe({validationSchema:G,initialValues:{full_name:"",phone_number:"",email:"",password:"",confirm_password:""}}),u=d(!1),y=d(!1),b=d(!1),F=()=>{R(),o.id=null,o.site_name="",u.value=!0,y.value=!1,b.value=!1},P=()=>{u.value=!1},i=d(!1),T=t=>{console.log(t);const e=t.response?.data;e?.code==="validation_error"&&Array.isArray(e.errors)?e.errors.forEach(a=>{x.error(a.message),B(a.field,a.message)}):e?Object.keys(e).forEach(a=>{const h=e[a],E=Array.isArray(h)?h[0]:h;B(a,E),x.error(E)}):x.error("حدث خطأ غير متوقع")},U=H(t=>{o.id?L(t):K(t)}),K=t=>{i.value=!0;const e={...t,role:"manager"};w.post("drivers/",e).then(a=>{i.value=!1,u.value=!1,m(),x.success("تم إضافة المندوب بنجاح")}).catch(a=>{T(a)}).finally(()=>{i.value=!1})},L=async t=>{i.value=!0;const e={...t,role:"manager"};e.password||(delete e.password,delete e.confirm_password),w.patch(`drivers/${o.id}/`,e).then(a=>{i.value=!1,u.value=!1,m(),x.success("تم تعديل بيانات المندوب بنجاح")}).catch(a=>{T(a)}).finally(()=>{i.value=!1})},W=t=>{w.get(`drivers/${t}/`).then(e=>{J({full_name:e.data.full_name,phone_number:e.data.phone_number,email:e.data.email,password:"",confirm_password:""}),o.id=e.data.id,o.site_name=e.data.full_name,u.value=!0})},X=async()=>{await w.delete(`drivers/${o.id}/`),m(),C.value=!1},m=t=>{i.value=!0;const e=t||1;w.get("drivers/",{params:{page:e,search:V.value||void 0,page_size:9}}).then(a=>{S.value=a.data.results,g.value={count:a.data.count||0,next:a.data.next,previous:a.data.previous,total_pages:Math.ceil((a.data.count||0)/10),page:e,pageSize:10}}).finally(()=>{i.value=!1})},Y=()=>{g.value.page=1,m(1)};return ie(()=>{m()}),(t,e)=>{const a=f("Header"),h=f("DataFilter"),E=f("router-link"),Z=f("DataTable"),ee=f("GenericModal"),te=f("DeletModal");return n(),c("div",me,[r(a,{title:"قائمة مندوبين التوصيل",buttonText:"إضافة مندوب  جديد",onBtnClick:F,type:"1"}),r(h,{searchQuery:V.value,"onUpdate:searchQuery":e[0]||(e[0]=l=>V.value=l),selectedStatus:A.value,"onUpdate:selectedStatus":e[1]||(e[1]=l=>A.value=l),statusOptions:O,searchPlaceholder:"ابحث باسم المندوب",onFilter:Y},null,8,["searchQuery","selectedStatus"]),r(Z,{headers:I,data:S.value,pagination:g.value,startIndex:Q.value,loading:i.value,onPageChange:m,onEmptyAction:F},{is_active:v(({row:l})=>[l.is_active===!0?(n(),c("p",fe," نشط ")):(n(),c("p",ve," غير نشط "))]),action:v(({row:l})=>[s("div",_e,[s("button",xe,[r(E,{to:{name:"view-one-delivery",params:{id:l.id}},class:"text-black hover:bg-gray-100 flex gap-2"},{default:v(()=>[...e[8]||(e[8]=[s("img",{src:ae,alt:"",class:""},null,-1),p(" عرض التفاصيل ",-1)])]),_:1},8,["to"])]),r(de,{actions:j(l.id)},null,8,["actions"])])]),_:1},8,["data","pagination","startIndex","loading"]),r(ee,{modelValue:u.value,"onUpdate:modelValue":e[6]||(e[6]=l=>u.value=l),title:o.id?"تعديل بيانات المندوب -  ("+o.site_name+")":"إضافة مندوب توصيل جديد",description:"ادخل معلومات المندوب لتاكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:P},{default:v(()=>[s("form",{onSubmit:e[5]||(e[5]=(...l)=>_(U)&&_(U)(...l))},[s("div",ge,[e[12]||(e[12]=s("label",{for:"full_name",class:"text-gray-700 text-sm text-start w-full"},[p(" اسم المندوب "),s("span",{class:"text-red-500"},"*")],-1)),r(D,{name:"full_name",id:"full_name",placeholder:"اسم المندوب"}),e[13]||(e[13]=s("label",{for:"phone_number",class:"text-gray-700 text-sm text-start mt-4"},[p("رقم الهاتف"),s("span",{class:"text-red-500"},"*")],-1)),r(D,{name:"phone_number",id:"phone_number",type:"tel",dir:"rtl",placeholder:"رقم الهاتف"}),e[14]||(e[14]=s("label",{for:"email",class:"text-gray-700 text-sm text-start mt-4"},[p("البريد الالكتروني "),s("span",{class:"text-red-500"},"*")],-1)),r(D,{name:"email",id:"email",type:"email",placeholder:"البريد الالكتروني"}),s("label",ye,[e[9]||(e[9]=p(" كلمة المرور ",-1)),o.id?M("",!0):(n(),c("span",be,"*"))]),r(D,{name:"password",id:"password",type:y.value?"text":"password",placeholder:"كلمة المرور"},{suffix:v(()=>[s("button",{type:"button",onClick:e[2]||(e[2]=l=>y.value=!y.value),class:"text-gray-500"},[y.value?(n(),$(_(N),{key:1,class:"h-5 w-5"})):(n(),$(_(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type"]),s("label",he,[e[10]||(e[10]=p(" تأكيد كلمة المرور ",-1)),o.id?M("",!0):(n(),c("span",we,"*"))]),r(D,{name:"confirm_password",id:"confirm_password",type:b.value?"text":"password",placeholder:"تأكيد كلمة المرور"},{suffix:v(()=>[s("button",{type:"button",onClick:e[3]||(e[3]=l=>b.value=!b.value),class:"text-gray-500"},[b.value?(n(),$(_(N),{key:1,class:"h-5 w-5"})):(n(),$(_(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type"]),t.generalErorr?(n(),c("span",ke,[e[11]||(e[11]=s("img",{src:se,alt:"",class:"h-6"},null,-1)),p(" "+q(t.generalErorr),1)])):M("",!0),s("div",De,[s("button",{type:"button",onClick:e[4]||(e[4]=l=>u.value=!1),class:"w-fit px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px] focus:outline-none focus:shadow-outline"}," إلغاء "),s("button",{type:"submit",class:"w-[160px] px-4 py-2 min-h-[48px] text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px] focus:outline-none focus:shadow-outline",disabled:i.value},[i.value?(n(),c("span",Ee," جاري .. ")):(n(),c("span",$e,q(o.id?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,Ce)])])],32)]),_:1},8,["modelValue","title"]),r(te,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),title:"هل انت متأكد انك تريد حذف مندوب التوصيل ("+o.site_name+")",description:"سيؤدي ذلك الي حذف كل المعلومات المرتبطة به","show-confirm-button":!0,"show-cancel-button":!0,onClose:P,onConfirm:X},null,8,["modelValue","title"])])}}};export{qe as default};
