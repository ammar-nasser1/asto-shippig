import{p as O,r as s,f as j,v,g as J,y,c as b,o as h,m as n,l as V,a as l,A as K,u as M,d as S,t as L}from"./index-Cy4IriJH.js";import{_ as R}from"./ActionMenu-D2gpSy1k.js";import{c as W,d as X,a as Y,u as Z}from"./index.esm-CRAaA_bq.js";import{_ as z}from"./InputField.vue_vue_type_script_setup_true_lang-2ibMJUC9.js";const ee={class:"flex flex-col gap-4 w-full"},te={class:"flex flex-col gap-y-1 pt-3"},ae={class:"flex justify-end items-center w-full gap-2 mt-4"},se=["disabled"],le={key:0},oe={key:1},pe={__name:"DeliveryPoints",setup(ne){const r=O(),c=s(!1),d=s(!1),f=s([]),g=s(""),_=s(""),i=s(!1),o=s(null),w=s(""),C={},u=s({count:0,page:1,pageSize:10}),$=j(()=>(u.value.page-1)*u.value.pageSize),E=[{label:"اسم الموقع",key:"name"},{label:"مبلغ التوصيل (ج.م)",key:"cost"},{label:"",key:"action"}],F=W({site_name:Y().required("اسم الموقع مطلوب"),price:X().transform((t,e)=>e===""?void 0:t).required("مبلغ التوصيل مطلوب").min(0,"يجب أن يكون المبلغ 0 أو أكثر").typeError("يجب أن يكون المبلغ رقماً")}),{handleSubmit:T,resetForm:A,setValues:U,errors:re}=Z({validationSchema:F,initialValues:{site_name:"",price:""}}),D=()=>{o.value=null,A(),c.value=!0},x=()=>{c.value=!1,d.value=!1},p=async(t=1)=>{i.value=!0;try{const e=await v.get("geo/delivery-zones/",{params:{page:t,search:g.value||void 0,page_size:9}});f.value=e.data.results,u.value.count=e.data.count,u.value.page=t}catch{r.error(" فشل في تحميل البيانات")}finally{i.value=!1}},B=async t=>{try{const e=await v.get(`geo/delivery-zones/${t}/`);o.value=e.data.id,U({site_name:e.data.name,price:e.data.cost}),c.value=!0}catch{r.error(" حدث خطأ أثناء تحميل البيانات")}},I=async()=>{try{await v.delete(`geo/delivery-zones/${o.value}/`),r.success("✅ تم حذف نقطة التوصيل بنجاح"),p()}catch{r.error(" حدث خطأ أثناء الحذف")}finally{d.value=!1}},k=T(async t=>{i.value=!0;const e={name:t.site_name,cost:t.price,city:1};try{o.value?(await v.patch(`geo/delivery-zones/${o.value}/`,e),r.success(" تم تحديث نقطة التوصيل بنجاح")):(await v.post("geo/delivery-zones/",e),r.success(" تم إضافة نقطة التوصيل بنجاح")),c.value=!1,p()}catch(m){r.error(m.response?.data?.message||" فشل في العملية")}finally{i.value=!1}}),N=()=>{u.value.page=1,p()},P=t=>[{label:"تعديل",handler:()=>B(t),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{const e=f.value.find(m=>m.id===t);o.value=t,w.value=e.name,d.value=!0},class:"text-red-500 hover:bg-gray-100"}];return J(()=>p()),(t,e)=>{const m=y("Header"),Q=y("DataFilter"),q=y("DataTable"),G=y("GenericModal"),H=y("DeletModal");return h(),b("div",ee,[n(m,{title:"قائمة نقاط التوصيل",buttonText:"إضافة نقطة توصيل جديدة",onBtnClick:D,type:"1"}),n(Q,{searchQuery:g.value,"onUpdate:searchQuery":e[0]||(e[0]=a=>g.value=a),selectedStatus:_.value,"onUpdate:selectedStatus":e[1]||(e[1]=a=>_.value=a),statusOptions:C,searchPlaceholder:"ابحث باسم المنطقة",onFilter:N},null,8,["searchQuery","selectedStatus"]),n(q,{headers:E,data:f.value,loading:i.value,pagination:u.value,startIndex:$.value,onPageChange:p,onEmptyAction:D},{action:V(({row:a})=>[n(R,{actions:P(a.id)},null,8,["actions"])]),_:1},8,["data","loading","pagination","startIndex"]),n(G,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),title:o.value?"تعديل نقطة التوصيل":"إضافة نقطة توصيل جديدة",description:"ادخل معلومات النقطة لتأكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:x},{default:V(()=>[l("form",{onSubmit:e[2]||(e[2]=K((...a)=>M(k)&&M(k)(...a),["prevent"]))},[l("div",te,[e[5]||(e[5]=l("label",{class:"text-gray-700 text-sm text-start w-full"},[S(" اسم الموقع "),l("span",{class:"text-red-500"},"*")],-1)),n(z,{name:"site_name",type:"text",placeholder:"اسم الموقع",class:"mt-2"}),e[6]||(e[6]=l("label",{class:"text-gray-700 text-sm text-start mt-4"},[S(" مبلغ التوصيل (ج.م) "),l("span",{class:"text-red-500"},"*")],-1)),n(z,{name:"price",type:"number",placeholder:"مبلغ التوصيل (ج.م)",class:"mt-2"}),l("div",ae,[l("button",{type:"button",onClick:x,class:"px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px]"}," إلغاء "),l("button",{type:"submit",class:"w-[160px] px-4 py-2 min-h-[48px] text-white rounded-[12px] bg-[#0E5895] disabled:opacity-50",disabled:i.value},[i.value?(h(),b("span",le,"جاري ...")):(h(),b("span",oe,L(o.value?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,se)])])],32)]),_:1},8,["modelValue","title"]),n(H,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),title:"هل أنت متأكد من حذف نقطة التوصيل ("+w.value+")?",description:"سيؤدي ذلك إلى حذف كل المعلومات المرتبطة بها","show-confirm-button":!0,"show-cancel-button":!0,onClose:x,onConfirm:I},null,8,["modelValue","title"])])}}};export{pe as default};
