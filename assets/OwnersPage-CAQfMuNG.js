import{_ as te}from"./failer-Dtv5Mqu6.js";import{x as se,r as d,f as le,p as oe,B as ne,v as g,g as re,y as w,c as x,o as u,m as r,l as k,d as m,t as A,u as f,a as o,b as B,k as $}from"./index-BFX93-Q2.js";import{_ as de}from"./ActionMenu-5icb-Pqw.js";import{f as ue}from"./formateDate-DG_0Qep_.js";import{c as ie,a as D,b as ce,u as pe}from"./index.esm-dMkGKBv0.js";import{_ as C}from"./InputField.vue_vue_type_script_setup_true_lang-fTW8IRMR.js";import{r as z,a as O}from"./EyeIcon-cIXzyWOF.js";const me={class:"flex flex-col gap-4 w-full"},fe={class:"flex flex-col gap-y-1 pt-3"},ve={for:"password",class:"text-gray-700 text-sm text-start mt-4"},ye={key:0,class:"text-red-500"},xe={for:"confirm_password",class:"text-gray-700 text-sm text-start mt-4"},_e={key:0,class:"text-red-500"},be={key:0,class:"bg-red-100 rounded-[12px] flex gap-2 py-3 mt-4 px-4 items-center text-sm text-start"},he={class:"flex justify-end items-center w-full gap-2 mt-4"},ge=["disabled"],we={key:0,class:""},ke={key:1},Fe={__name:"OwnersPage",setup(De){se();const S=d(!1),E=d([]),M=d(""),F=d(""),N={},_=d({count:0,next:null,previous:null,page:1,pageSize:10}),Q=le(()=>(_.value.page-1)*_.value.pageSize),I=[{label:" الاسم",key:"full_name"},{label:"رقم الهاتف",key:"phone_number"},{label:"البريد الالكتروني",key:"email"},{label:"التاريخ",key:"created"},{label:"",key:"action"}],j=a=>[{label:"تعديل",handler:()=>X(a),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{s.id=a,s.site_name=E.value.find(e=>e.id===a).full_name,S.value=!0},class:"text-red-500 hover:bg-gray-100"}],b=oe(),s=ne({id:null,site_name:""}),G=ie({full_name:D().required("الاسم مطلوب"),phone_number:D().required("رقم الهاتف مطلوب"),email:D().email("البريد الإلكتروني غير صالح").required("البريد الإلكتروني مطلوب"),password:D().when([],{is:()=>!s.id,then:a=>a.required("كلمة المرور مطلوبة").min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),otherwise:a=>a.nullable().transform((e,t)=>t===""?null:e).min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل")}),confirm_password:D().when("password",{is:a=>a&&a.length>0,then:a=>a.required("تأكيد كلمة المرور مطلوب").oneOf([ce("password")],"كلمة المرور غير متطابقة"),otherwise:a=>a.nullable()})}),{handleSubmit:H,resetForm:R,setValues:J,setFieldError:P,errors:Ce}=pe({validationSchema:G,initialValues:{full_name:"",phone_number:"",email:"",password:"",confirm_password:""}}),i=d(!1),c=d(!1),p=d(!1),v=d(""),K=()=>{R(),s.id=null,s.site_name="",v.value="",c.value=!1,p.value=!1,i.value=!0},T=()=>{i.value=!1,c.value=!1,p.value=!1,v.value=""},n=d(!1),U=a=>{const e=a.response?.data;v.value="",e?.code==="validation_error"&&Array.isArray(e.errors)?e.errors.forEach(t=>{b.error(t.message),P(t.field,t.message)}):e?Object.keys(e).forEach(t=>{const h=e[t],V=Array.isArray(h)?h[0]:h;P(t,V),b.error(V)}):b.error("حدث خطأ غير متوقع")},q=H(a=>{s.id?W(a):L(a)}),L=a=>{n.value=!0;const e={...a,role:"owner"};g.post("users/",e).then(t=>{n.value=!1,i.value=!1,b.success(" تم إضافة المالك بنجاح"),y()}).catch(t=>{U(t)}).finally(()=>{n.value=!1})},W=async a=>{n.value=!0;const e={...a,role:"owner"};e.password||(delete e.password,delete e.confirm_password),g.patch(`users/${s.id}/`,e).then(t=>{b.success(" تم تعديل المالك بنجاح"),n.value=!1,i.value=!1,y()}).catch(t=>{U(t)}).finally(()=>{n.value=!1})},X=a=>{g.get(`users/${a}/`).then(e=>{J({full_name:e.data.full_name,phone_number:e.data.phone_number,email:e.data.email,password:"",confirm_password:""}),s.id=e.data.id,s.site_name=e.data.full_name,i.value=!0,v.value="",c.value=!1,p.value=!1})},Y=async()=>{await g.delete(`users/${s.id}/`),y(),S.value=!1},y=a=>{const e=a||1;n.value=!0,g.get("users/",{params:{page:e,search:M.value||void 0,role:"owner",page_size:9}}).then(t=>{E.value=t.data.results,_.value={count:t.data.count||0,next:t.data.next,previous:t.data.previous,total_pages:Math.ceil((t.data.count||0)/10),page:e,pageSize:9}}).finally(()=>{n.value=!1})},Z=()=>{_.value.page=1,y(1)};return re(()=>{y()}),(a,e)=>{const t=w("Header"),h=w("DataFilter"),V=w("DataTable"),ee=w("GenericModal"),ae=w("DeletModal");return u(),x("div",me,[r(t,{title:"قائمة الملاك",buttonText:"إضافة مالك جديد",onBtnClick:K,type:"1"}),r(h,{searchQuery:M.value,"onUpdate:searchQuery":e[0]||(e[0]=l=>M.value=l),selectedStatus:F.value,"onUpdate:selectedStatus":e[1]||(e[1]=l=>F.value=l),statusOptions:N,searchPlaceholder:"ابحث باسم المالك  ",onFilter:Z},null,8,["searchQuery","selectedStatus"]),r(V,{headers:I,data:E.value,loading:n.value,pagination:_.value,startIndex:Q.value,onPageChange:y},{created:k(({row:l})=>[m(A(f(ue)(l.created)),1)]),action:k(({row:l})=>[r(de,{actions:j(l.id)},null,8,["actions"])]),_:1},8,["data","loading","pagination","startIndex"]),r(ee,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value=l),title:s.id?"تعديل بيانات المالك -  ("+s.site_name+")":" إضافة مالك جديد",description:"ادخل معلومات المالك لتاكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:T},{default:k(()=>[o("form",{onSubmit:e[5]||(e[5]=(...l)=>f(q)&&f(q)(...l))},[o("div",fe,[e[11]||(e[11]=o("label",{for:"full_name",class:"text-gray-700 text-sm text-start w-full"},[m(" اسم المالك "),o("span",{class:"text-red-500"},"*")],-1)),r(C,{name:"full_name",id:"full_name",placeholder:"اسم المالك"}),e[12]||(e[12]=o("label",{for:"phone_number",class:"text-gray-700 text-sm text-start mt-4"},[m("رقم الهاتف"),o("span",{class:"text-red-500"},"*")],-1)),r(C,{name:"phone_number",id:"phone_number",type:"tel",dir:"rtl",placeholder:"رقم الهاتف"}),e[13]||(e[13]=o("label",{for:"email",class:"text-gray-700 text-sm text-start mt-4"},[m("البريد الالكتروني "),o("span",{class:"text-red-500"},"*")],-1)),r(C,{name:"email",id:"email",type:"email",disabled:s.id,placeholder:"البريد الالكتروني"},null,8,["disabled"]),o("label",ve,[e[8]||(e[8]=m(" كلمة المرور ",-1)),s.id?B("",!0):(u(),x("span",ye,"*"))]),r(C,{name:"password",id:"password",type:c.value?"text":"password",placeholder:s.id?"اتركه فارغاً إذا لم تريد تغيير كلمة المرور":"كلمة المرور"},{suffix:k(()=>[o("button",{type:"button",onClick:e[2]||(e[2]=l=>c.value=!c.value),class:"text-gray-500"},[c.value?(u(),$(f(O),{key:1,class:"h-5 w-5"})):(u(),$(f(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type","placeholder"]),o("label",xe,[e[9]||(e[9]=m(" تأكيد كلمة المرور ",-1)),s.id?B("",!0):(u(),x("span",_e,"*"))]),r(C,{name:"confirm_password",id:"confirm_password",type:p.value?"text":"password",placeholder:s.id?"اتركه فارغاً إذا لم تريد تغيير كلمة المرور":"تأكيد كلمة المرور"},{suffix:k(()=>[o("button",{type:"button",onClick:e[3]||(e[3]=l=>p.value=!p.value),class:"text-gray-500"},[p.value?(u(),$(f(O),{key:1,class:"h-5 w-5"})):(u(),$(f(z),{key:0,class:"h-5 w-5"}))])]),_:1},8,["type","placeholder"]),v.value?(u(),x("span",be,[e[10]||(e[10]=o("img",{src:te,alt:"",class:"h-6"},null,-1)),m(" "+A(v.value),1)])):B("",!0),o("div",he,[o("button",{type:"button",onClick:e[4]||(e[4]=l=>i.value=!1),class:"w-fit px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px] focus:outline-none focus:shadow-outline"}," إلغاء "),o("button",{type:"submit",class:"w-[160px] px-4 py-2 min-h-[48px] text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px] focus:outline-none focus:shadow-outline",disabled:n.value},[n.value?(u(),x("span",we," جاري .. ")):(u(),x("span",ke,A(s.id?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,ge)])])],32)]),_:1},8,["modelValue","title"]),r(ae,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=l=>S.value=l),title:"هل انت متأكد انك تريد حذف نقطة التوصيل ("+s.site_name+")",description:"سيؤدي ذلك الي حذف كل المعلومات المرتبطة به","show-confirm-button":!0,"show-cancel-button":!0,onClose:T,onConfirm:Y},null,8,["modelValue","title"])])}}};export{Fe as default};
