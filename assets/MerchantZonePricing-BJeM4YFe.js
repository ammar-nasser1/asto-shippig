import{p as J,x as K,M as W,r as s,f as X,v as p,g as Y,y,c as z,o as w,m as n,u as g,l as V,d as M,t as I,a as o,A as ee,N as te,O as ae}from"./index-CeYGxhDv.js";import{_ as se}from"./ActionMenu-CBWHMkpD.js";import{c as oe,d as le,a as re,u as ne}from"./index.esm-DtWfIWb9.js";import{_ as ie}from"./InputField.vue_vue_type_script_setup_true_lang-C7gPgC9C.js";const de={class:"flex flex-col gap-4 w-full"},ce={class:"flex flex-col gap-y-1 pt-3"},ue={class:"flex justify-end items-center w-full gap-2 mt-4"},pe=["disabled"],ve={key:0},me={key:1},xe={__name:"MerchantZonePricing",setup(ye){const l=J();K();const f=W(),c=s(!1),v=s(!1),S=s([]),_=s(""),D=s(""),i=s(!1),r=s(null),$={},u=s({count:0,page:1,pageSize:10}),E=X(()=>(u.value.page-1)*u.value.pageSize),P=[{label:"منطقة التوصيل",key:"delivery_zone"},{label:"السعر (ج.م)",key:"price"},{label:"",key:"action"}],A=oe({delivery_zone:re().required("منطقة التوصيل مطلوبة"),price:le().transform((t,e)=>e===""?void 0:t).required("السعر مطلوب").min(0,"يجب أن يكون السعر 0 أو أكثر").typeError("يجب أن يكون السعر رقماً")}),{handleSubmit:N,resetForm:T,setValues:U,setFieldValue:ge,errors:Z,defineField:B}=ne({validationSchema:A,initialValues:{delivery_zone:"",price:""}}),[b]=B("delivery_zone"),k=()=>{r.value=null,T(),c.value=!0},h=()=>{c.value=!1,v.value=!1},m=async(t=1)=>{i.value=!0;try{const e=f.params.id,d=await p.get("pricing/trader-delivery-zones/",{params:{page:t,search:_.value||void 0,page_size:9,trader:e}});S.value=d.data.results,u.value.count=d.data.count,u.value.page=t}catch{l.error(" فشل في تحميل البيانات")}finally{i.value=!1}},C=s([]),O=async t=>{try{const e=await p.get(`pricing/trader-delivery-zones/${t}/`);r.value=e.data.id,U({delivery_zone:e.data.delivery_zone.id,price:e.data.price}),c.value=!0}catch{l.error(" حدث خطأ أثناء تحميل البيانات")}},Q=async()=>{try{await p.delete(`pricing/trader-delivery-zones/${r.value}/`),l.success("✅ تم حذف سعر المنطقة بنجاح"),m()}catch{l.error(" حدث خطأ أثناء الحذف")}finally{v.value=!1}},F=N(async t=>{i.value=!0;const e=parseInt(f.params.id),d={price:t.price.toString(),trader:e.toString(),delivery_zone:parseInt(t.delivery_zone)};try{r.value?(await p.patch(`pricing/trader-delivery-zones/${r.value}/`,d),l.success(" تم تحديث سعر المنطقة بنجاح")):(await p.post("pricing/trader-delivery-zones/",d),l.success(" تم إضافة سعر المنطقة بنجاح")),c.value=!1,m()}catch(x){l.error(x.response?.data?.message||" فشل في العملية")}finally{i.value=!1}}),q=()=>{u.value.page=1,m()},R=t=>[{label:"تعديل",handler:()=>O(t),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{r.value=t,v.value=!0},class:"text-red-500 hover:bg-gray-100"}],G=async()=>{try{const t=await p.get("geo/delivery-zones/?no_paginate=true");C.value=t.data.results.map(e=>({value:e.id,label:e.name+" ( "+e.cost+" )"}))}catch{l.error(" حدث خطأ أثناء تحميل مناطق التوصيل")}};return Y(()=>{m(),G()}),(t,e)=>{const d=y("Header"),x=y("DataFilter"),H=y("DataTable"),L=y("GenericModal"),j=y("DeletModal");return w(),z("div",de,[n(d,{title:"أسعار مناطق التجار",buttonText:"إضافة سعر منطقة جديد",onBtnClick:k,subtitle:g(f).query?.traderName,type:"1"},null,8,["subtitle"]),n(x,{searchQuery:_.value,"onUpdate:searchQuery":e[0]||(e[0]=a=>_.value=a),selectedStatus:D.value,"onUpdate:selectedStatus":e[1]||(e[1]=a=>D.value=a),statusOptions:$,searchPlaceholder:"ابحث باسم المنطقة",onFilter:q},null,8,["searchQuery","selectedStatus"]),n(H,{headers:P,data:S.value,loading:i.value,pagination:u.value,startIndex:E.value,onPageChange:m,onEmptyAction:k},{delivery_zone:V(({row:a})=>[M(I(a?.delivery_zone?.name||"-"),1)]),action:V(({row:a})=>[n(se,{actions:R(a.id)},null,8,["actions"])]),_:1},8,["data","loading","pagination","startIndex"]),n(L,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value=a),title:r.value?"تعديل سعر المنطقة":"إضافة سعر منطقة جديد",description:"ادخل معلومات السعر لتأكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:h},{default:V(()=>[o("form",{onSubmit:e[3]||(e[3]=ee((...a)=>g(F)&&g(F)(...a),["prevent"]))},[o("div",ce,[e[6]||(e[6]=o("label",{class:"text-gray-700 text-sm text-start mt-4"},[M(" منطقة التوصيل"),o("span",{class:"text-red-500"},"*")],-1)),n(te,{modelValue:g(b),"onUpdate:modelValue":e[2]||(e[2]=a=>ae(b)?b.value=a:null),options:C.value,placeholder:"اختر المنطقة",searchable:"",error:g(Z).delivery_zone},null,8,["modelValue","options","error"]),e[7]||(e[7]=o("label",{class:"text-gray-700 text-sm text-start mt-4"},[M(" السعر (ج.م) "),o("span",{class:"text-red-500"},"*")],-1)),n(ie,{name:"price",type:"number",placeholder:"السعر (ج.م)",class:"mt-2"}),o("div",ue,[o("button",{type:"button",onClick:h,class:"px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px]"}," إلغاء "),o("button",{type:"submit",class:"w-[160px] px-4 py-2 min-h-[48px] text-white rounded-[12px] bg-[#0E5895] disabled:opacity-50",disabled:i.value},[i.value?(w(),z("span",ve,"جاري ...")):(w(),z("span",me,I(r.value?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,pe)])])],32)]),_:1},8,["modelValue","title"]),n(j,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a),title:"هل أنت متأكد من حذف سعر المنطقة؟",description:"سيؤدي ذلك إلى حذف كل المعلومات المرتبطة بها","show-confirm-button":!0,"show-cancel-button":!0,onClose:h,onConfirm:Q},null,8,["modelValue"])])}}};export{xe as default};
