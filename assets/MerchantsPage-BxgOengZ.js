import{x as X,p as Y,r as s,f as Z,v as f,g as ee,y as d,c as b,o as h,m as o,l as g,a as l,z as te,t as z,A as ae,u as E,d as y}from"./index-CeYGxhDv.js";import{_ as le}from"./eye-BFqmBmJx.js";import{_ as se}from"./ActionMenu-CBWHMkpD.js";import{c as oe,a as w,u as ne}from"./index.esm-DtWfIWb9.js";import{_ as k}from"./InputField.vue_vue_type_script_setup_true_lang-C7gPgC9C.js";const re={class:"flex flex-col gap-4 w-full h-full"},ie={class:"flex gap-2"},ue={class:"border border-[#CBD7E1] rounded-lg p-2 mb-1 flex gap-2"},de={class:"flex flex-col gap-y-1 pt-3"},ce={class:"flex justify-end items-center w-full gap-2 mt-4"},me=["disabled"],pe={key:0,class:""},ve={key:1},we={__name:"MerchantsPage",setup(fe){X();const c=Y(),m=s(!1),x=s([]),_=s(""),D=s(""),i=s(!1),r=s(null),S=s(""),M=s(""),F={},p=s({count:0,next:null,previous:null,page:1,pageSize:10}),T={active:"text-green-500 bg-green-100",inactive:"text-red-500 bg-red-100",suspended:"text-yellow-500 bg-yellow-100"},U=Z(()=>(p.value.page-1)*p.value.pageSize),A={active:"نشط",inactive:"غير نشط",suspended:"موقوف"},B=t=>A[t]||t,N=[{label:"اسم التاجر",key:"full_name"},{label:"اجمالي المبيعات",key:"total_sales"},{label:" عدد الطلبات",key:"orders_count"},{label:"صافي الرصيد",key:"balance"},{label:"الحالة",key:"status"},{label:"",key:"action"}],I=oe({site_name:w().required("اسم التاجر مطلوب"),phone:w().required("هذا الحقل مطلوب").matches(/^[0-9]+$/,"يجب أن يحتوي على أرقام فقط").length(11,"يجب أن يكون رقم الهاتف 11 رقم"),email:w().email("بريد إلكتروني غير صالح").required("البريد الإلكتروني مطلوب")}),{handleSubmit:Q,resetForm:q,setValues:P,errors:ge}=ne({validationSchema:I,initialValues:{site_name:"",phone:"",email:""}}),G=t=>[{label:"تعديل",handler:()=>H(t),class:"text-black hover:bg-gray-100"},{label:"حذف",handler:()=>{r.value=t,M.value=x.value.find(e=>e.id===t).full_name,m.value=!0},class:"text-red-500 hover:bg-gray-100"}],H=t=>{f.get(`traders/${t}/`).then(e=>{r.value=e.data.id,S.value=e.data.full_name,P({site_name:e.data.full_name,phone:e.data.phone_number,email:e.data.email}),u.value=!0})},O=async()=>{try{await f.delete(`traders/${r.value}/`),c.success("تم حذف التاجر بنجاح"),v(),m.value=!1}catch(t){c.error(t.response?.data?.message||"حدث خطأ أثناء الحذف")}},v=t=>{i.value=!0;const e=t||1;f.get("traders/",{params:{page:e,search:_.value||void 0,page_size:9}}).then(n=>{x.value=n.data.results,p.value={count:n.data.count||0,next:n.data.next,previous:n.data.previous,total_pages:Math.ceil((n.data.count||0)/10),page:e,pageSize:9}}).finally(()=>{i.value=!1})},j=()=>{p.value.page=1,v(1)},u=s(!1),C=()=>{r.value=null,q(),u.value=!0},V=()=>{u.value=!1,m.value=!1},$=Q(async t=>{i.value=!0;const e={full_name:t.site_name,phone_number:t.phone,email:t.email};try{r.value?(await f.patch(`traders/${r.value}/`,e),c.success("تم تحديث بيانات التاجر بنجاح")):(await f.post("traders/",{...e,balance:0}),c.success("تم إضافة تاجر جديد بنجاح")),u.value=!1,v()}catch(n){c.error(n.response?.data?.message||"حدث خطأ ما")}finally{i.value=!1}});return ee(()=>{v()}),(t,e)=>{const n=d("Header"),R=d("DataFilter"),J=d("router-link"),K=d("DataTable"),L=d("GenericModal"),W=d("DeletModal");return h(),b("div",re,[o(n,{title:"قائمة التجار",buttonText:"إضافة تاجر جديد",onBtnClick:C,type:"1"}),o(R,{searchQuery:_.value,"onUpdate:searchQuery":e[0]||(e[0]=a=>_.value=a),selectedStatus:D.value,"onUpdate:selectedStatus":e[1]||(e[1]=a=>D.value=a),statusOptions:F,searchPlaceholder:"ابحث باسم التاجر ",onFilter:j},null,8,["searchQuery","selectedStatus"]),o(K,{headers:N,data:x.value,pagination:p.value,startIndex:U.value,loading:i.value,onPageChange:v,onEmptyAction:C},{status:g(({row:a})=>[l("p",{class:te(["p-2 rounded-3xl text-sm w-40 text-center",T[a.is_active?"active":"inactive"]])},z(B(a.is_active?"active":"inactive")),3)]),action:g(({row:a})=>[l("div",ie,[l("button",ue,[o(J,{to:{name:"view-one-merchant",params:{id:a.id}},class:"text-black hover:bg-gray-100 flex-nowrap flex gap-2"},{default:g(()=>[...e[6]||(e[6]=[l("img",{src:le,alt:"",class:""},null,-1),l("div",null,"عرض التفاصيل",-1)])]),_:1},8,["to"])]),o(se,{actions:G(a.id)},null,8,["actions"])])]),_:1},8,["data","pagination","startIndex","loading"]),o(L,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),title:r.value?"تعديل بيانات التاجر-   ("+S.value+")":"إضافة تاجر جديد",description:"ادخل معلومات النقطة لتاكيد الإضافة","show-header-icon":!0,size:"large","show-footer":!1,onClose:V},{default:g(()=>[l("form",{action:"",onSubmit:e[3]||(e[3]=ae((...a)=>E($)&&E($)(...a),["prevent"]))},[l("div",de,[e[7]||(e[7]=l("label",{for:"site_name",class:"text-gray-700 text-sm text-start w-full"},[y(" اسم التاجر"),l("span",{class:"text-red-500"},"*")],-1)),o(k,{name:"site_name",type:"text",placeholder:"اسم التاجر",class:"mt-2"}),e[8]||(e[8]=l("label",{for:"phone",class:"text-gray-700 text-sm text-start mt-4"},[y("رقم الهاتف"),l("span",{class:"text-red-500"},"*")],-1)),o(k,{name:"phone",type:"tel",dir:"rtl",maxlength:"11",placeholder:"رقم الهاتف",class:"mt-2"}),e[9]||(e[9]=l("label",{for:"email",class:"text-gray-700 text-sm text-start mt-4"},[y("البريد الالكتروني "),l("span",{class:"text-red-500"},"*")],-1)),o(k,{name:"email",type:"email",placeholder:"البريد الالكتروني",class:"mt-2"}),l("div",ce,[l("button",{type:"button",onClick:e[2]||(e[2]=a=>u.value=!1),class:"w-fit px-8 py-2 min-h-[48px] text-black bg-[#DEDEDE] rounded-[12px]"}," إلغاء "),l("button",{class:"w-[160px] px-4 py-2 min-h-[48px] text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#0E5895] rounded-[12px]",disabled:i.value,type:"submit"},[i.value?(h(),b("span",pe," جاري .. ")):(h(),b("span",ve,z(r.value?"تأكيد التعديل":"تأكيد الإضافة"),1))],8,me)])])],32)]),_:1},8,["modelValue","title"]),o(W,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),title:"هل انت متأكد انك تريد حذف التاجر ("+M.value+")",description:"سيؤدي ذلك الي حذف كل المعلومات المرتبطة به","show-confirm-button":!0,"show-cancel-button":!0,onClose:V,onConfirm:O},null,8,["modelValue","title"])])}}};export{we as default};
